(()=>{"use strict";var e={923:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConwayHTMLDisplayer=t.DEFAULTGAMERULE=t.ConwayGameFactory=t.ConwayGame=t.ConwayCell=void 0;var n=function(){function e(e){void 0===e&&(e=!1),this.alive=e}return Object.defineProperty(e.prototype,"is_alive",{get:function(){return this.alive},enumerable:!1,configurable:!0}),e}();t.ConwayCell=n;var r=function(){function e(e,t){this.xPos=e,this.yPos=t}return Object.defineProperty(e.prototype,"xPosition",{get:function(){return this.xPos},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yPosition",{get:function(){return this.yPos},enumerable:!1,configurable:!0}),e}(),i=function(){function e(e,t,n,r){void 0===n&&(n=[2,3]),void 0===r&&(r=[3]),this.result_state=e,this.viewed_cell_positions=t,this.alive_goes_to_result_state_with_neighbours=n,this.dead_goes_to_result_state_with_neighbours=r}return e.prototype.applyRuleToGame=function(e,t,r,i){var o=r.cell_living_neighbours(e,t,this.viewed_cell_positions,r.gameField),a=r.gameField[e][t],s=this.alive_goes_to_result_state_with_neighbours.some((function(e){return o==e})),l=this.dead_goes_to_result_state_with_neighbours.some((function(e){return o==e}));return(a.is_alive&&s||!a.is_alive&&l)&&(i.gameField[e][t]=new n(this.result_state)),i},e}(),o=function(){function e(e,t,n,r,i){void 0===i&&(i="cutoff"),this.xSize=e,this.ySize=t,this.borderRules=i,this.gameField=null==n?this.create_empty_conways_cell_array():n,this.rules=r}return e.prototype.setCell=function(e,t,n){this.gameField[t][e]=n},e.prototype.create_empty_conways_cell_array=function(){var e=this;return new Array(this.ySize).fill(!1).map((function(){return new Array(e.xSize).fill(new n(!1))}))},e.prototype.next_conway_state=function(){for(var t=this,n=this.create_empty_conways_cell_array(),r=new e(this.xSize,this.ySize,n,this.rules),i=function(e){for(var n=function(n){o.rules.forEach((function(i){i.applyRuleToGame(e,n,t,r)}))},i=0;i<o.ySize;i++)n(i)},o=this,a=0;a<this.xSize;a++)i(a);return r},e.prototype.cell_living_neighbours=function(e,t,n,r){var i=this,o=0;return n.forEach((function(n,a,s){var l=n.xPosition,u=n.yPosition,c=e+l,h=t+u;i.in_field(c,h)&&r[c][h].is_alive&&(o+=1)})),o},e.prototype.in_field=function(e,t){return e>0&&t>0&&e<this.xSize&&t<this.ySize},e}();t.ConwayGame=o;var a=function(){function e(e,t,n){this.xSize=e,this.ySize=t,this.rules=n}return e.prototype.centeredfPentomino=function(){if(this.xSize<3&&this.ySize<3)return console.error("Cannot create a Pentomino in a field smaller than 3 times 3"),null;var e=this.get_center(),t=new o(this.xSize,this.ySize,null,this.rules,"cutoff");return t.gameField[e.xPos][e.yPos]=new n(!0),t.gameField[e.xPos][e.yPos+1]=new n(!0),t.gameField[e.xPos][e.yPos-1]=new n(!0),t.gameField[e.xPos-1][e.yPos]=new n(!0),t.gameField[e.xPos+1][e.yPos+1]=new n(!0),t},e.prototype.circle=function(e){for(var t=this.get_center(),i=new o(this.xSize,this.ySize,null,this.rules,"cutoff"),a=0;a<e;a++)for(var s=new r(0,a),l=0;l<2*Math.PI;l+=1/(2*Math.PI)){var u=t.xPos-Math.round(s.xPos*Math.cos(l)+-1*s.yPos*Math.sin(l)),c=t.yPos+Math.round(s.xPos*Math.sin(l)+s.yPos*Math.cos(l));i.gameField[u][c]=new n(!0)}return console.log(i.gameField[300][217]),i},e.prototype.yline=function(e){for(var t=this.get_center(),r=new o(this.xSize,this.ySize,null,this.rules,"cutoff"),i=0;i<e;i++)r.gameField[t.xPos][t.yPos+i]=new n(!0),console.log("Creating line at"+t.xPos+" "+t.yPos+"length: "+i);return r},e.prototype.get_center=function(){var e=Math.ceil(this.xSize/2),t=Math.ceil(this.ySize/2);return new r(e,t)},e.prototype.randomize_cells=function(){for(var e=new o(this.xSize,this.ySize,null,this.rules,"cutoff"),t=0;t<this.xSize;t++)for(var r=0;r<this.ySize;r++)Math.round(10*Math.random())>=3&&(e.gameField[t][r]=new n(!0));return e},e}();t.ConwayGameFactory=a;var s=function(){function e(e,t,n,r){this.r=e,this.g=t,this.b=n,this.a=r}return Object.defineProperty(e.prototype,"data",{get:function(){return[this.r,this.g,this.b,this.a]},enumerable:!1,configurable:!0}),e}(),l=function(){function e(e){this.default_cell_alive_repr="ðŸŸ©",this.default_cell_dead_repr="â¬œ",this.conway_game=e,this.cell_repr_alive=new s(255,255,255,255),this.cell_repr_dead=new s(0,0,20,255),this.cell_repr_transparent=new s(0,0,0,0)}return e.prototype.representation=function(e){return e.is_alive?this.default_cell_alive_repr:this.default_cell_dead_repr},e.prototype.str_field=function(){for(var e="",t=0;t<this.conway_game.xSize;t++){for(var n=0;n<this.conway_game.ySize;n++){var r=this.conway_game.gameField[t][n];e+=this.representation(r)}e+="\n"}return e},e.prototype.as_number_colors_arr=function(){for(var e=[],t=0;t<this.conway_game.xSize;t++)for(var n=0;n<this.conway_game.ySize;n++)this.conway_game.gameField[t][n].is_alive?e[t+this.conway_game.ySize*n]=this.cell_repr_alive:e[t+this.conway_game.ySize*n]=this.cell_repr_dead;return e},e}(),u=function(){function e(e,t){this.xStyleCanvas=e,this.yStyleCanvas=t}return e.prototype.updateEmojiGameFieldAsString=function(e){var t=document.getElementById("gameField");if(null!=t){var n=new l(e);t.innerHTML=n.str_field()}},e.prototype.updategameFieldPixelsAsCanvas=function(e){var t=new l(e),n=document.getElementById("gameField");if(null!=n){n.style.width="500px",n.style.height="500px";var r=document.createElement("canvas");r.style.width="500px",r.style.height="500px";var i=r.getContext("2d"),o=e.xSize,a=e.ySize,s=null==i?void 0:i.createImageData(o,a);if(console.log("Created with size:"+o+","+a),s){var u=t.as_number_colors_arr();console.log("length of arr"+u.length);for(var c=0,h=0;h<s.data.length;h+=4){var y=u[c].data;s.data[h+0]=y[0],s.data[h+1]=y[1],s.data[h+2]=y[2],s.data[h+3]=y[3],c+=1}null==i||i.putImageData(s,0,0),i&&(i.imageSmoothingEnabled=!1),n.replaceChildren(r)}}else console.error("couldn't find the gameField")},e.prototype.displayGeneration=function(e){var t=document.getElementById("GameFieldCurrentGeneration");if(null!=t){var n=document.createElement("h1");n.innerHTML="current Generation: "+e.toString(),t.childNodes.forEach((function(e){e.remove()})),t.appendChild(n)}},e}();t.ConwayHTMLDisplayer=u;var c=new Array(new r(-1,-1),new r(-1,0),new r(-1,1),new r(0,1),new r(0,-1),new r(1,1),new r(1,0),new r(1,-1)),h=new Array(new i(!0,c,[2,3],[3]));t.DEFAULTGAMERULE=h,new Array(new i(!0,c,[2],[2])),new Array(new i(!0,c,[1,3,5,7],[1,3,5,7])),new Array(new i(!0,c,[3],[3])),new Array(new i(!0,c,[2,3,6],[3])),new Array(new i(!0,c,[2],[2])),new Array(new i(!0,c,[3],[2]))},156:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(923);function a(e){return new Promise((function(t){return setTimeout(t,e)}))}!function(){r(this,void 0,void 0,(function(){var e,t,n,r;return i(this,(function(i){switch(i.label){case 0:return e=new o.ConwayGameFactory(500,500,o.DEFAULTGAMERULE),null==(t=e.circle(100))?[2]:((n=new o.ConwayHTMLDisplayer("100%","100%")).updategameFieldPixelsAsCanvas(t),n.displayGeneration(-1),[4,a(1e4)]);case 1:i.sent(),r=0,i.label=2;case 2:return r<2e3?(n.displayGeneration(r),t=t.next_conway_state(),n.updategameFieldPixelsAsCanvas(t),console.log("next generation"+r),[4,a(200)]):[3,5];case 3:i.sent(),i.label=4;case 4:return r++,[3,2];case 5:return[2]}}))}))}()}},t={};!function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}(156)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUE4QnVFLEdBQzNDM0gsUUFBUWlCLElBQUksa0JBQW9Cd0QsR0FDekIsQ0FBQyxFQUFhOEMsRUFBTSxPQUxNLENBQUMsRUFBYSxHQU1uRCxLQUFLLEVBQ0RNLEVBQUdwQixPQUNIb0IsRUFBR3JCLE1BQVEsRUFDZixLQUFLLEVBRUQsT0FEQS9CLElBQ08sQ0FBQyxFQUFhLEdBQ3pCLEtBQUssRUFBRyxNQUFPLENBQUMsR0FFeEIsR0FDSixHQUNKLENBRUFxRCxFLEdDL0VJQyxFQUEyQixDQUFDLEdBR2hDLFNBQVNDLEVBQW9CQyxHQUU1QixJQUFJQyxFQUFlSCxFQUF5QkUsR0FDNUMsUUFBcUJFLElBQWpCRCxFQUNILE9BQU9BLEVBQWF0TSxRQUdyQixJQUFJd00sRUFBU0wsRUFBeUJFLEdBQVksQ0FHakRyTSxRQUFTLENBQUMsR0FPWCxPQUhBeU0sRUFBb0JKLEdBQVVkLEtBQUtpQixFQUFPeE0sUUFBU3dNLEVBQVFBLEVBQU94TSxRQUFTb00sR0FHcEVJLEVBQU94TSxPQUNmLENDbkIwQm9NLENBQW9CLEkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZV9vZl9saWZlLnRzIiwid2VicGFjazovLy8uL3NyYy9pbmRleC50cyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQ29ud2F5SFRNTERpc3BsYXllciA9IGV4cG9ydHMuREVGQVVMVEdBTUVSVUxFID0gZXhwb3J0cy5Db253YXlHYW1lRmFjdG9yeSA9IGV4cG9ydHMuQ29ud2F5R2FtZSA9IGV4cG9ydHMuQ29ud2F5Q2VsbCA9IHZvaWQgMDtcbnZhciBDb253YXlDZWxsID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIENvbndheUNlbGwoYWxpdmUpIHtcbiAgICAgICAgaWYgKGFsaXZlID09PSB2b2lkIDApIHsgYWxpdmUgPSBmYWxzZTsgfVxuICAgICAgICB0aGlzLmFsaXZlID0gYWxpdmU7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb253YXlDZWxsLnByb3RvdHlwZSwgXCJpc19hbGl2ZVwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWxpdmU7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICByZXR1cm4gQ29ud2F5Q2VsbDtcbn0oKSk7XG5leHBvcnRzLkNvbndheUNlbGwgPSBDb253YXlDZWxsO1xudmFyIENlbGxQb3NpdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBDZWxsUG9zaXRpb24oeFBvcywgeVBvcykge1xuICAgICAgICB0aGlzLnhQb3MgPSB4UG9zO1xuICAgICAgICB0aGlzLnlQb3MgPSB5UG9zO1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ2VsbFBvc2l0aW9uLnByb3RvdHlwZSwgXCJ4UG9zaXRpb25cIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnhQb3M7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ2VsbFBvc2l0aW9uLnByb3RvdHlwZSwgXCJ5UG9zaXRpb25cIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnlQb3M7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICByZXR1cm4gQ2VsbFBvc2l0aW9uO1xufSgpKTtcbi8vIFJ1bGUgd2hpY2ggc2hvdWxkIG9ubHkgdXNlIHRoZSBzdXJyb25kaW5nIGNlbGxzIHRvIGRlZmluZSBhIG5ldyBzdGF0ZVxudmFyIENvbndheUdhbWVSdWxlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIENvbndheUdhbWVSdWxlKHJlc3VsdF9zdGF0ZSwgdmlld2VkX2NlbGxzLCBhbGl2ZV9nb2VzX3RvX3Jlc3VsdF9zdGF0ZV93aXRoX25laWdoYm91cnMsIGRlYWRfZ29lc190b19yZXN1bHRfc3RhdGVfd2l0aF9uZWlnaGJvdXJzKSB7XG4gICAgICAgIGlmIChhbGl2ZV9nb2VzX3RvX3Jlc3VsdF9zdGF0ZV93aXRoX25laWdoYm91cnMgPT09IHZvaWQgMCkgeyBhbGl2ZV9nb2VzX3RvX3Jlc3VsdF9zdGF0ZV93aXRoX25laWdoYm91cnMgPSBbMiwgM107IH1cbiAgICAgICAgaWYgKGRlYWRfZ29lc190b19yZXN1bHRfc3RhdGVfd2l0aF9uZWlnaGJvdXJzID09PSB2b2lkIDApIHsgZGVhZF9nb2VzX3RvX3Jlc3VsdF9zdGF0ZV93aXRoX25laWdoYm91cnMgPSBbM107IH1cbiAgICAgICAgdGhpcy5yZXN1bHRfc3RhdGUgPSByZXN1bHRfc3RhdGU7XG4gICAgICAgIHRoaXMudmlld2VkX2NlbGxfcG9zaXRpb25zID0gdmlld2VkX2NlbGxzO1xuICAgICAgICB0aGlzLmFsaXZlX2dvZXNfdG9fcmVzdWx0X3N0YXRlX3dpdGhfbmVpZ2hib3VycyA9IGFsaXZlX2dvZXNfdG9fcmVzdWx0X3N0YXRlX3dpdGhfbmVpZ2hib3VycztcbiAgICAgICAgdGhpcy5kZWFkX2dvZXNfdG9fcmVzdWx0X3N0YXRlX3dpdGhfbmVpZ2hib3VycyA9IGRlYWRfZ29lc190b19yZXN1bHRfc3RhdGVfd2l0aF9uZWlnaGJvdXJzO1xuICAgIH1cbiAgICBDb253YXlHYW1lUnVsZS5wcm90b3R5cGUuYXBwbHlSdWxlVG9HYW1lID0gZnVuY3Rpb24gKHhQb3MsIHlQb3MsIG9sZF9jb253YXlfZ2FtZSwgbmV3X2NvbndheV9nYW1lKSB7XG4gICAgICAgIHZhciBsaXZpbmdfbmVpZ2hib3VyX2NvdW50ID0gb2xkX2NvbndheV9nYW1lLmNlbGxfbGl2aW5nX25laWdoYm91cnMoeFBvcywgeVBvcywgdGhpcy52aWV3ZWRfY2VsbF9wb3NpdGlvbnMsIG9sZF9jb253YXlfZ2FtZS5nYW1lRmllbGQpO1xuICAgICAgICB2YXIgY2VsbCA9IG9sZF9jb253YXlfZ2FtZS5nYW1lRmllbGRbeFBvc11beVBvc107XG4gICAgICAgIHZhciBpc19hbGl2ZV9uZWlnaGJvdXJfY291bnQgPSB0aGlzLmFsaXZlX2dvZXNfdG9fcmVzdWx0X3N0YXRlX3dpdGhfbmVpZ2hib3Vycy5zb21lKGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gbGl2aW5nX25laWdoYm91cl9jb3VudCA9PSB2YWx1ZTsgfSk7XG4gICAgICAgIHZhciBpc19kZWFkX25laWdoYm91cl9jb3VudCA9IHRoaXMuZGVhZF9nb2VzX3RvX3Jlc3VsdF9zdGF0ZV93aXRoX25laWdoYm91cnMuc29tZShmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIGxpdmluZ19uZWlnaGJvdXJfY291bnQgPT0gdmFsdWU7IH0pO1xuICAgICAgICBpZiAoY2VsbC5pc19hbGl2ZSAmJiBpc19hbGl2ZV9uZWlnaGJvdXJfY291bnQpIHtcbiAgICAgICAgICAgIG5ld19jb253YXlfZ2FtZS5nYW1lRmllbGRbeFBvc11beVBvc10gPSBuZXcgQ29ud2F5Q2VsbCh0aGlzLnJlc3VsdF9zdGF0ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIWNlbGwuaXNfYWxpdmUgJiYgaXNfZGVhZF9uZWlnaGJvdXJfY291bnQpIHtcbiAgICAgICAgICAgIG5ld19jb253YXlfZ2FtZS5nYW1lRmllbGRbeFBvc11beVBvc10gPSBuZXcgQ29ud2F5Q2VsbCh0aGlzLnJlc3VsdF9zdGF0ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ld19jb253YXlfZ2FtZTtcbiAgICB9O1xuICAgIHJldHVybiBDb253YXlHYW1lUnVsZTtcbn0oKSk7XG52YXIgQ29ud2F5R2FtZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBDb253YXlHYW1lKHB4U2l6ZSwgcHlTaXplLCBjZWxscywgcnVsZXMsIGJvcmRlclJ1bGVzKSB7XG4gICAgICAgIGlmIChib3JkZXJSdWxlcyA9PT0gdm9pZCAwKSB7IGJvcmRlclJ1bGVzID0gXCJjdXRvZmZcIjsgfVxuICAgICAgICB0aGlzLnhTaXplID0gcHhTaXplO1xuICAgICAgICB0aGlzLnlTaXplID0gcHlTaXplO1xuICAgICAgICB0aGlzLmJvcmRlclJ1bGVzID0gYm9yZGVyUnVsZXM7XG4gICAgICAgIGlmIChjZWxscyA9PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLmdhbWVGaWVsZCA9IHRoaXMuY3JlYXRlX2VtcHR5X2NvbndheXNfY2VsbF9hcnJheSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5nYW1lRmllbGQgPSBjZWxscztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJ1bGVzID0gcnVsZXM7XG4gICAgfVxuICAgIENvbndheUdhbWUucHJvdG90eXBlLnNldENlbGwgPSBmdW5jdGlvbiAoeFBvcywgeVBvcywgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5nYW1lRmllbGRbeVBvc11beFBvc10gPSB2YWx1ZTtcbiAgICB9O1xuICAgIENvbndheUdhbWUucHJvdG90eXBlLmNyZWF0ZV9lbXB0eV9jb253YXlzX2NlbGxfYXJyYXkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgQXJyYXkodGhpcy55U2l6ZSkuZmlsbChmYWxzZSkubWFwKGZ1bmN0aW9uICgpIHsgcmV0dXJuIG5ldyBBcnJheShfdGhpcy54U2l6ZSkuZmlsbChuZXcgQ29ud2F5Q2VsbChmYWxzZSkpOyB9KTtcbiAgICB9O1xuICAgIENvbndheUdhbWUucHJvdG90eXBlLm5leHRfY29ud2F5X3N0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgbmV3X2NvbndheV9jZWxsX2ZpZWxkID0gdGhpcy5jcmVhdGVfZW1wdHlfY29ud2F5c19jZWxsX2FycmF5KCk7XG4gICAgICAgIHZhciBuZXdfY29ud2F5X2dhbWUgPSBuZXcgQ29ud2F5R2FtZSh0aGlzLnhTaXplLCB0aGlzLnlTaXplLCBuZXdfY29ud2F5X2NlbGxfZmllbGQsIHRoaXMucnVsZXMpO1xuICAgICAgICB2YXIgX2xvb3BfMSA9IGZ1bmN0aW9uIChpbmRleFgpIHtcbiAgICAgICAgICAgIHZhciBfbG9vcF8yID0gZnVuY3Rpb24gKGluZGV4WSkge1xuICAgICAgICAgICAgICAgIHRoaXNfMS5ydWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChydWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJ1bGUuYXBwbHlSdWxlVG9HYW1lKGluZGV4WCwgaW5kZXhZLCBfdGhpcywgbmV3X2NvbndheV9nYW1lKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBmb3IgKHZhciBpbmRleFkgPSAwOyBpbmRleFkgPCB0aGlzXzEueVNpemU7IGluZGV4WSsrKSB7XG4gICAgICAgICAgICAgICAgX2xvb3BfMihpbmRleFkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB2YXIgdGhpc18xID0gdGhpcztcbiAgICAgICAgZm9yICh2YXIgaW5kZXhYID0gMDsgaW5kZXhYIDwgdGhpcy54U2l6ZTsgaW5kZXhYKyspIHtcbiAgICAgICAgICAgIF9sb29wXzEoaW5kZXhYKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3X2NvbndheV9nYW1lO1xuICAgIH07XG4gICAgQ29ud2F5R2FtZS5wcm90b3R5cGUuY2VsbF9saXZpbmdfbmVpZ2hib3VycyA9IGZ1bmN0aW9uIChpbmRleFgsIGluZGV4WSwgbG9va2luZ0F0LCBnYW1lRmllbGQpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIGNvdW50ID0gMDtcbiAgICAgICAgbG9va2luZ0F0LmZvckVhY2goZnVuY3Rpb24gKGxpc3QsIHZhbCwgYXJyKSB7XG4gICAgICAgICAgICB2YXIgeDEgPSBsaXN0LnhQb3NpdGlvbjtcbiAgICAgICAgICAgIHZhciB5MSA9IGxpc3QueVBvc2l0aW9uO1xuICAgICAgICAgICAgdmFyIGEgPSBpbmRleFggKyB4MTtcbiAgICAgICAgICAgIHZhciBiID0gaW5kZXhZICsgeTE7XG4gICAgICAgICAgICBpZiAoX3RoaXMuaW5fZmllbGQoYSwgYikgJiYgZ2FtZUZpZWxkW2FdW2JdLmlzX2FsaXZlKSB7XG4gICAgICAgICAgICAgICAgY291bnQgKz0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBjb3VudDtcbiAgICB9O1xuICAgIENvbndheUdhbWUucHJvdG90eXBlLmluX2ZpZWxkID0gZnVuY3Rpb24gKGluZGV4WCwgaW5kZXhZKSB7XG4gICAgICAgIHZhciBpbkZpZWxkID0gKChpbmRleFggPiAwICYmIGluZGV4WSA+IDApICYmIChpbmRleFggPCB0aGlzLnhTaXplICYmIGluZGV4WSA8IHRoaXMueVNpemUpKTtcbiAgICAgICAgcmV0dXJuIGluRmllbGQ7XG4gICAgfTtcbiAgICByZXR1cm4gQ29ud2F5R2FtZTtcbn0oKSk7XG5leHBvcnRzLkNvbndheUdhbWUgPSBDb253YXlHYW1lO1xudmFyIENvbndheUdhbWVGYWN0b3J5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIENvbndheUdhbWVGYWN0b3J5KHhTaXplLCB5U2l6ZSwgcnVsZXMpIHtcbiAgICAgICAgdGhpcy54U2l6ZSA9IHhTaXplO1xuICAgICAgICB0aGlzLnlTaXplID0geVNpemU7XG4gICAgICAgIHRoaXMucnVsZXMgPSBydWxlcztcbiAgICB9XG4gICAgQ29ud2F5R2FtZUZhY3RvcnkucHJvdG90eXBlLmNlbnRlcmVkZlBlbnRvbWlubyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMueFNpemUgPCAzICYmIHRoaXMueVNpemUgPCAzKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiQ2Fubm90IGNyZWF0ZSBhIFBlbnRvbWlubyBpbiBhIGZpZWxkIHNtYWxsZXIgdGhhbiAzIHRpbWVzIDNcIik7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcG9zID0gdGhpcy5nZXRfY2VudGVyKCk7XG4gICAgICAgIHZhciBjb253YXlfZ2FtZSA9IG5ldyBDb253YXlHYW1lKHRoaXMueFNpemUsIHRoaXMueVNpemUsIG51bGwsIHRoaXMucnVsZXMsIFwiY3V0b2ZmXCIpO1xuICAgICAgICBjb253YXlfZ2FtZS5nYW1lRmllbGRbcG9zLnhQb3NdW3Bvcy55UG9zXSA9IG5ldyBDb253YXlDZWxsKHRydWUpO1xuICAgICAgICBjb253YXlfZ2FtZS5nYW1lRmllbGRbcG9zLnhQb3NdW3Bvcy55UG9zICsgMV0gPSBuZXcgQ29ud2F5Q2VsbCh0cnVlKTtcbiAgICAgICAgY29ud2F5X2dhbWUuZ2FtZUZpZWxkW3Bvcy54UG9zXVtwb3MueVBvcyAtIDFdID0gbmV3IENvbndheUNlbGwodHJ1ZSk7XG4gICAgICAgIGNvbndheV9nYW1lLmdhbWVGaWVsZFtwb3MueFBvcyAtIDFdW3Bvcy55UG9zXSA9IG5ldyBDb253YXlDZWxsKHRydWUpO1xuICAgICAgICBjb253YXlfZ2FtZS5nYW1lRmllbGRbcG9zLnhQb3MgKyAxXVtwb3MueVBvcyArIDFdID0gbmV3IENvbndheUNlbGwodHJ1ZSk7XG4gICAgICAgIHJldHVybiBjb253YXlfZ2FtZTtcbiAgICB9O1xuICAgIENvbndheUdhbWVGYWN0b3J5LnByb3RvdHlwZS5jaXJjbGUgPSBmdW5jdGlvbiAocmFkaXVzKSB7XG4gICAgICAgIHZhciBwb3MgPSB0aGlzLmdldF9jZW50ZXIoKTtcbiAgICAgICAgdmFyIGNvbndheV9nYW1lID0gbmV3IENvbndheUdhbWUodGhpcy54U2l6ZSwgdGhpcy55U2l6ZSwgbnVsbCwgdGhpcy5ydWxlcywgXCJjdXRvZmZcIik7XG4gICAgICAgIGZvciAodmFyIHJhZGl1c0luYyA9IDA7IHJhZGl1c0luYyA8IHJhZGl1czsgcmFkaXVzSW5jKyspIHtcbiAgICAgICAgICAgIHZhciBwb3NUb1JvdGF0ZSA9IG5ldyBDZWxsUG9zaXRpb24oMCwgcmFkaXVzSW5jKTtcbiAgICAgICAgICAgIGZvciAodmFyIGFuZ2xlID0gMDsgYW5nbGUgPCAyICogTWF0aC5QSTsgYW5nbGUgKz0gMSAvICgyICogTWF0aC5QSSkpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV3WFBvcyA9IHBvcy54UG9zIC0gKE1hdGgucm91bmQocG9zVG9Sb3RhdGUueFBvcyAqIE1hdGguY29zKGFuZ2xlKSArIHBvc1RvUm90YXRlLnlQb3MgKiAtMSAqIE1hdGguc2luKGFuZ2xlKSkpO1xuICAgICAgICAgICAgICAgIHZhciBuZXdZUG9zID0gcG9zLnlQb3MgKyAoTWF0aC5yb3VuZChwb3NUb1JvdGF0ZS54UG9zICogTWF0aC5zaW4oYW5nbGUpICsgcG9zVG9Sb3RhdGUueVBvcyAqIE1hdGguY29zKGFuZ2xlKSkpO1xuICAgICAgICAgICAgICAgIGNvbndheV9nYW1lLmdhbWVGaWVsZFtuZXdYUG9zXVtuZXdZUG9zXSA9IG5ldyBDb253YXlDZWxsKHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKGNvbndheV9nYW1lLmdhbWVGaWVsZFszMDBdWzIxN10pO1xuICAgICAgICByZXR1cm4gY29ud2F5X2dhbWU7XG4gICAgfTtcbiAgICBDb253YXlHYW1lRmFjdG9yeS5wcm90b3R5cGUueWxpbmUgPSBmdW5jdGlvbiAobGVuZ3RoKSB7XG4gICAgICAgIHZhciBjZW50ZXIgPSB0aGlzLmdldF9jZW50ZXIoKTtcbiAgICAgICAgdmFyIGNvbndheV9nYW1lID0gbmV3IENvbndheUdhbWUodGhpcy54U2l6ZSwgdGhpcy55U2l6ZSwgbnVsbCwgdGhpcy5ydWxlcywgXCJjdXRvZmZcIik7XG4gICAgICAgIGZvciAodmFyIGN1ckxlbmd0aCA9IDA7IGN1ckxlbmd0aCA8IGxlbmd0aDsgY3VyTGVuZ3RoKyspIHtcbiAgICAgICAgICAgIGNvbndheV9nYW1lLmdhbWVGaWVsZFtjZW50ZXIueFBvc11bY2VudGVyLnlQb3MgKyBjdXJMZW5ndGhdID0gbmV3IENvbndheUNlbGwodHJ1ZSk7IC8vIFRPRE8gY3JlYXRlIHkgUG9zaXRpb25zXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNyZWF0aW5nIGxpbmUgYXRcIiArIGNlbnRlci54UG9zICsgXCIgXCIgKyBjZW50ZXIueVBvcyArIFwibGVuZ3RoOiBcIiArIGN1ckxlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbndheV9nYW1lO1xuICAgIH07XG4gICAgQ29ud2F5R2FtZUZhY3RvcnkucHJvdG90eXBlLmdldF9jZW50ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBtaWRkbGVYID0gTWF0aC5jZWlsKHRoaXMueFNpemUgLyAyKTtcbiAgICAgICAgdmFyIG1pZGRsZVkgPSBNYXRoLmNlaWwodGhpcy55U2l6ZSAvIDIpO1xuICAgICAgICByZXR1cm4gbmV3IENlbGxQb3NpdGlvbihtaWRkbGVYLCBtaWRkbGVZKTtcbiAgICB9O1xuICAgIENvbndheUdhbWVGYWN0b3J5LnByb3RvdHlwZS5yYW5kb21pemVfY2VsbHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjb253YXlfZ2FtZSA9IG5ldyBDb253YXlHYW1lKHRoaXMueFNpemUsIHRoaXMueVNpemUsIG51bGwsIHRoaXMucnVsZXMsIFwiY3V0b2ZmXCIpO1xuICAgICAgICBmb3IgKHZhciBpbmRleFggPSAwOyBpbmRleFggPCB0aGlzLnhTaXplOyBpbmRleFgrKykge1xuICAgICAgICAgICAgZm9yICh2YXIgaW5kZXhZID0gMDsgaW5kZXhZIDwgdGhpcy55U2l6ZTsgaW5kZXhZKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgcmFuZF92YWwgPSBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICAgICAgICAgICAgaWYgKHJhbmRfdmFsID49IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29ud2F5X2dhbWUuZ2FtZUZpZWxkW2luZGV4WF1baW5kZXhZXSA9IG5ldyBDb253YXlDZWxsKHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29ud2F5X2dhbWU7XG4gICAgfTtcbiAgICByZXR1cm4gQ29ud2F5R2FtZUZhY3Rvcnk7XG59KCkpO1xuZXhwb3J0cy5Db253YXlHYW1lRmFjdG9yeSA9IENvbndheUdhbWVGYWN0b3J5O1xudmFyIENlbGxDb2xvciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBDZWxsQ29sb3IociwgZywgYiwgYSkge1xuICAgICAgICB0aGlzLnIgPSByO1xuICAgICAgICB0aGlzLmcgPSBnO1xuICAgICAgICB0aGlzLmIgPSBiO1xuICAgICAgICB0aGlzLmEgPSBhO1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ2VsbENvbG9yLnByb3RvdHlwZSwgXCJkYXRhXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gW3RoaXMuciwgdGhpcy5nLCB0aGlzLmIsIHRoaXMuYV07XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICByZXR1cm4gQ2VsbENvbG9yO1xufSgpKTtcbnZhciBDb253YXlHYW1lUmVwcmVzZW50ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQ29ud2F5R2FtZVJlcHJlc2VudGVyKGNvbndheV9nYW1lKSB7XG4gICAgICAgIHRoaXMuZGVmYXVsdF9jZWxsX2FsaXZlX3JlcHIgPSBcIvCfn6lcIjtcbiAgICAgICAgdGhpcy5kZWZhdWx0X2NlbGxfZGVhZF9yZXByID0gXCLirJxcIjtcbiAgICAgICAgdGhpcy5jb253YXlfZ2FtZSA9IGNvbndheV9nYW1lO1xuICAgICAgICB0aGlzLmNlbGxfcmVwcl9hbGl2ZSA9IG5ldyBDZWxsQ29sb3IoMjU1LCAyNTUsIDI1NSwgMjU1KTtcbiAgICAgICAgdGhpcy5jZWxsX3JlcHJfZGVhZCA9IG5ldyBDZWxsQ29sb3IoMCwgMCwgMjAsIDI1NSk7XG4gICAgICAgIHRoaXMuY2VsbF9yZXByX3RyYW5zcGFyZW50ID0gbmV3IENlbGxDb2xvcigwLCAwLCAwLCAwKTtcbiAgICB9XG4gICAgQ29ud2F5R2FtZVJlcHJlc2VudGVyLnByb3RvdHlwZS5yZXByZXNlbnRhdGlvbiA9IGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgIGlmIChjZWxsLmlzX2FsaXZlKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kZWZhdWx0X2NlbGxfYWxpdmVfcmVwcjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5kZWZhdWx0X2NlbGxfZGVhZF9yZXByO1xuICAgIH07XG4gICAgQ29ud2F5R2FtZVJlcHJlc2VudGVyLnByb3RvdHlwZS5zdHJfZmllbGQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciByZXN1bHRfc3RyID0gXCJcIjtcbiAgICAgICAgZm9yICh2YXIgaW5kZXhYID0gMDsgaW5kZXhYIDwgdGhpcy5jb253YXlfZ2FtZS54U2l6ZTsgaW5kZXhYKyspIHtcbiAgICAgICAgICAgIGZvciAodmFyIGluZGV4WSA9IDA7IGluZGV4WSA8IHRoaXMuY29ud2F5X2dhbWUueVNpemU7IGluZGV4WSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNlbGwgPSB0aGlzLmNvbndheV9nYW1lLmdhbWVGaWVsZFtpbmRleFhdW2luZGV4WV07XG4gICAgICAgICAgICAgICAgcmVzdWx0X3N0ciArPSB0aGlzLnJlcHJlc2VudGF0aW9uKGNlbGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzdWx0X3N0ciArPSBcIlxcblwiO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHRfc3RyO1xuICAgIH07XG4gICAgQ29ud2F5R2FtZVJlcHJlc2VudGVyLnByb3RvdHlwZS5hc19udW1iZXJfY29sb3JzX2FyciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpbmRleFggPSAwOyBpbmRleFggPCB0aGlzLmNvbndheV9nYW1lLnhTaXplOyBpbmRleFgrKykge1xuICAgICAgICAgICAgZm9yICh2YXIgaW5kZXhZID0gMDsgaW5kZXhZIDwgdGhpcy5jb253YXlfZ2FtZS55U2l6ZTsgaW5kZXhZKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgY2VsbCA9IHRoaXMuY29ud2F5X2dhbWUuZ2FtZUZpZWxkW2luZGV4WF1baW5kZXhZXTtcbiAgICAgICAgICAgICAgICBpZiAoY2VsbC5pc19hbGl2ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRbaW5kZXhYICsgKHRoaXMuY29ud2F5X2dhbWUueVNpemUpICogaW5kZXhZXSA9IHRoaXMuY2VsbF9yZXByX2FsaXZlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2luZGV4WCArICh0aGlzLmNvbndheV9nYW1lLnlTaXplKSAqIGluZGV4WV0gPSB0aGlzLmNlbGxfcmVwcl9kZWFkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG4gICAgcmV0dXJuIENvbndheUdhbWVSZXByZXNlbnRlcjtcbn0oKSk7XG52YXIgQ29ud2F5SFRNTERpc3BsYXllciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBDb253YXlIVE1MRGlzcGxheWVyKHhTdHlsZSwgeVN0eWxlKSB7XG4gICAgICAgIHRoaXMueFN0eWxlQ2FudmFzID0geFN0eWxlO1xuICAgICAgICB0aGlzLnlTdHlsZUNhbnZhcyA9IHlTdHlsZTtcbiAgICB9XG4gICAgQ29ud2F5SFRNTERpc3BsYXllci5wcm90b3R5cGUudXBkYXRlRW1vamlHYW1lRmllbGRBc1N0cmluZyA9IGZ1bmN0aW9uIChjb253YXlHYW1lKSB7XG4gICAgICAgIHZhciBnYW1lU3BhY2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImdhbWVGaWVsZFwiKTtcbiAgICAgICAgaWYgKGdhbWVTcGFjZSAhPSBudWxsKSB7XG4gICAgICAgICAgICB2YXIgcmVwcmVzZW50ZXIgPSBuZXcgQ29ud2F5R2FtZVJlcHJlc2VudGVyKGNvbndheUdhbWUpO1xuICAgICAgICAgICAgZ2FtZVNwYWNlLmlubmVySFRNTCA9IHJlcHJlc2VudGVyLnN0cl9maWVsZCgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBDb253YXlIVE1MRGlzcGxheWVyLnByb3RvdHlwZS51cGRhdGVnYW1lRmllbGRQaXhlbHNBc0NhbnZhcyA9IGZ1bmN0aW9uIChjb253YXlHYW1lKSB7XG4gICAgICAgIHZhciByZXByZXNlbnRlciA9IG5ldyBDb253YXlHYW1lUmVwcmVzZW50ZXIoY29ud2F5R2FtZSk7XG4gICAgICAgIHZhciBnYW1lU3BhY2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImdhbWVGaWVsZFwiKTtcbiAgICAgICAgaWYgKGdhbWVTcGFjZSA9PSBudWxsKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiY291bGRuJ3QgZmluZCB0aGUgZ2FtZUZpZWxkXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGdhbWVTcGFjZS5zdHlsZS53aWR0aCA9IFwiNTAwcHhcIjtcbiAgICAgICAgZ2FtZVNwYWNlLnN0eWxlLmhlaWdodCA9IFwiNTAwcHhcIjtcbiAgICAgICAgdmFyIG5ld19jYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgICAgICBuZXdfY2FudmFzLnN0eWxlLndpZHRoID0gXCI1MDBweFwiO1xuICAgICAgICBuZXdfY2FudmFzLnN0eWxlLmhlaWdodCA9IFwiNTAwcHhcIjtcbiAgICAgICAgdmFyIGNvbnRleHQgPSBuZXdfY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgICAgdmFyIHhPZmZzZXQgPSBjb253YXlHYW1lLnhTaXplO1xuICAgICAgICB2YXIgeU9mZnNldCA9IGNvbndheUdhbWUueVNpemU7XG4gICAgICAgIHZhciBpbWFnZURhdGEgPSBjb250ZXh0ID09PSBudWxsIHx8IGNvbnRleHQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbnRleHQuY3JlYXRlSW1hZ2VEYXRhKHhPZmZzZXQsIHlPZmZzZXQpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIkNyZWF0ZWQgd2l0aCBzaXplOlwiICsgeE9mZnNldCArIFwiLFwiICsgeU9mZnNldCk7XG4gICAgICAgIGlmICghaW1hZ2VEYXRhKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG51bWJlcl9jb2xvcl9hcnIgPSByZXByZXNlbnRlci5hc19udW1iZXJfY29sb3JzX2FycigpO1xuICAgICAgICBjb25zb2xlLmxvZyhcImxlbmd0aCBvZiBhcnJcIiArIG51bWJlcl9jb2xvcl9hcnIubGVuZ3RoKTtcbiAgICAgICAgdmFyIGN1cl9yZXNfaW5kZXggPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGltYWdlRGF0YS5kYXRhLmxlbmd0aDsgaSArPSA0KSB7XG4gICAgICAgICAgICB2YXIgY2VsbF9yZXByID0gbnVtYmVyX2NvbG9yX2FycltjdXJfcmVzX2luZGV4XTtcbiAgICAgICAgICAgIHZhciBjZWxsX3JlcHJfZGF0YSA9IGNlbGxfcmVwci5kYXRhO1xuICAgICAgICAgICAgaW1hZ2VEYXRhLmRhdGFbaSArIDBdID0gY2VsbF9yZXByX2RhdGFbMF07IC8vIFIgdmFsdWVcbiAgICAgICAgICAgIGltYWdlRGF0YS5kYXRhW2kgKyAxXSA9IGNlbGxfcmVwcl9kYXRhWzFdOyAvLyBHIHZhbHVlXG4gICAgICAgICAgICBpbWFnZURhdGEuZGF0YVtpICsgMl0gPSBjZWxsX3JlcHJfZGF0YVsyXTsgLy8gQiB2YWx1ZVxuICAgICAgICAgICAgaW1hZ2VEYXRhLmRhdGFbaSArIDNdID0gY2VsbF9yZXByX2RhdGFbM107IC8vIEEgdmFsdWVcbiAgICAgICAgICAgIGN1cl9yZXNfaW5kZXggKz0gMTtcbiAgICAgICAgfVxuICAgICAgICBjb250ZXh0ID09PSBudWxsIHx8IGNvbnRleHQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbnRleHQucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgMCk7XG4gICAgICAgIGlmIChjb250ZXh0KSB7XG4gICAgICAgICAgICBjb250ZXh0LmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGdhbWVTcGFjZS5yZXBsYWNlQ2hpbGRyZW4obmV3X2NhbnZhcyk7XG4gICAgfTtcbiAgICBDb253YXlIVE1MRGlzcGxheWVyLnByb3RvdHlwZS5kaXNwbGF5R2VuZXJhdGlvbiA9IGZ1bmN0aW9uIChnZW5lcmF0aW9uKSB7XG4gICAgICAgIHZhciBjdXJyZW50R2VuZXJhdGlvbkVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIkdhbWVGaWVsZEN1cnJlbnRHZW5lcmF0aW9uXCIpO1xuICAgICAgICBpZiAoY3VycmVudEdlbmVyYXRpb25FbGVtZW50ICE9IG51bGwpIHtcbiAgICAgICAgICAgIHZhciBuZXdfZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJoMVwiKTtcbiAgICAgICAgICAgIG5ld19lbGVtZW50LmlubmVySFRNTCA9IFwiY3VycmVudCBHZW5lcmF0aW9uOiBcIiArIGdlbmVyYXRpb24udG9TdHJpbmcoKTtcbiAgICAgICAgICAgIGN1cnJlbnRHZW5lcmF0aW9uRWxlbWVudC5jaGlsZE5vZGVzLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnJlbW92ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjdXJyZW50R2VuZXJhdGlvbkVsZW1lbnQuYXBwZW5kQ2hpbGQobmV3X2VsZW1lbnQpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gQ29ud2F5SFRNTERpc3BsYXllcjtcbn0oKSk7XG5leHBvcnRzLkNvbndheUhUTUxEaXNwbGF5ZXIgPSBDb253YXlIVE1MRGlzcGxheWVyO1xudmFyIFNVUlJPVU5ESU5HUE9TSVRJT05TID0gbmV3IEFycmF5KG5ldyBDZWxsUG9zaXRpb24oLTEsIC0xKSwgbmV3IENlbGxQb3NpdGlvbigtMSwgMCksIG5ldyBDZWxsUG9zaXRpb24oLTEsIDEpLCBuZXcgQ2VsbFBvc2l0aW9uKDAsIDEpLCBuZXcgQ2VsbFBvc2l0aW9uKDAsIC0xKSwgbmV3IENlbGxQb3NpdGlvbigxLCAxKSwgbmV3IENlbGxQb3NpdGlvbigxLCAwKSwgbmV3IENlbGxQb3NpdGlvbigxLCAtMSkpO1xudmFyIERFRkFVTFRHQU1FUlVMRSA9IG5ldyBBcnJheShuZXcgQ29ud2F5R2FtZVJ1bGUodHJ1ZSwgU1VSUk9VTkRJTkdQT1NJVElPTlMsIFsyLCAzXSwgWzNdKSk7XG5leHBvcnRzLkRFRkFVTFRHQU1FUlVMRSA9IERFRkFVTFRHQU1FUlVMRTtcbnZhciBNVUxUSVBMSUNBVElPTkdBTUVSVUxFID0gbmV3IEFycmF5KG5ldyBDb253YXlHYW1lUnVsZSh0cnVlLCBTVVJST1VORElOR1BPU0lUSU9OUywgWzJdLCBbMl0pKTtcbnZhciBDT1BZR0FNRVJVTEVTID0gbmV3IEFycmF5KG5ldyBDb253YXlHYW1lUnVsZSh0cnVlLCBTVVJST1VORElOR1BPU0lUSU9OUywgWzEsIDMsIDUsIDddLCBbMSwgMywgNSwgN10pKTtcbnZhciBXT1JMRDMzUlVMRVMgPSBuZXcgQXJyYXkobmV3IENvbndheUdhbWVSdWxlKHRydWUsIFNVUlJPVU5ESU5HUE9TSVRJT05TLCBbM10sIFszXSkpO1xudmFyIFdPUkxEMjM2UlVMRVMgPSBuZXcgQXJyYXkobmV3IENvbndheUdhbWVSdWxlKHRydWUsIFNVUlJPVU5ESU5HUE9TSVRJT05TLCBbMiwgMywgNl0sIFszXSkpO1xudmFyIFNOQUtFS0lOR1JVTEVJREVBID0gbmV3IEFycmF5KG5ldyBDb253YXlHYW1lUnVsZSh0cnVlLCBTVVJST1VORElOR1BPU0lUSU9OUywgWzJdLCBbMl0pKTtcbnZhciBXT1JMRDQ0UlVMRVMgPSBuZXcgQXJyYXkobmV3IENvbndheUdhbWVSdWxlKHRydWUsIFNVUlJPVU5ESU5HUE9TSVRJT05TLCBbM10sIFsyXSkpO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2dlbmVyYXRvciA9ICh0aGlzICYmIHRoaXMuX19nZW5lcmF0b3IpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBib2R5KSB7XG4gICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZztcbiAgICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgXCJ0aHJvd1wiOiB2ZXJiKDEpLCBcInJldHVyblwiOiB2ZXJiKDIpIH0sIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZztcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cbiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7XG4gICAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtcbiAgICAgICAgd2hpbGUgKGcgJiYgKGcgPSAwLCBvcFswXSAmJiAoXyA9IDApKSwgXykgdHJ5IHtcbiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbXCJyZXR1cm5cIl0gOiBvcFswXSA/IHlbXCJ0aHJvd1wiXSB8fCAoKHQgPSB5W1wicmV0dXJuXCJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDtcbiAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTtcbiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9O1xuICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xuICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9XG4gICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9O1xuICAgIH1cbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgZ2FtZV9vZl9saWZlXzEgPSByZXF1aXJlKFwiLi9nYW1lX29mX2xpZmVcIik7XG5mdW5jdGlvbiBzbGVlcChtcykge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXR1cm4gc2V0VGltZW91dChyZXNvbHZlLCBtcyk7IH0pO1xufVxuZnVuY3Rpb24gbWFpbigpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjb253YXlHYW1lRmFjdG9yeSwgY3VycmVudENvbndheUdhbWUsIGZpZWxkX2RyYXdlciwgZ2VuZXJhdGlvbjtcbiAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgY29ud2F5R2FtZUZhY3RvcnkgPSBuZXcgZ2FtZV9vZl9saWZlXzEuQ29ud2F5R2FtZUZhY3RvcnkoNTAwLCA1MDAsIGdhbWVfb2ZfbGlmZV8xLkRFRkFVTFRHQU1FUlVMRSk7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDb253YXlHYW1lID0gY29ud2F5R2FtZUZhY3RvcnkuY2lyY2xlKDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Q29ud2F5R2FtZSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZmllbGRfZHJhd2VyID0gbmV3IGdhbWVfb2ZfbGlmZV8xLkNvbndheUhUTUxEaXNwbGF5ZXIoXCIxMDAlXCIsIFwiMTAwJVwiKTtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRfZHJhd2VyLnVwZGF0ZWdhbWVGaWVsZFBpeGVsc0FzQ2FudmFzKGN1cnJlbnRDb253YXlHYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRfZHJhd2VyLmRpc3BsYXlHZW5lcmF0aW9uKC0xKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgc2xlZXAoMTAwMDApXTtcbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMjtcbiAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgIGlmICghKGdlbmVyYXRpb24gPCAyMDAwKSkgcmV0dXJuIFszIC8qYnJlYWsqLywgNV07XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkX2RyYXdlci5kaXNwbGF5R2VuZXJhdGlvbihnZW5lcmF0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudENvbndheUdhbWUgPSBjdXJyZW50Q29ud2F5R2FtZS5uZXh0X2NvbndheV9zdGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICBmaWVsZF9kcmF3ZXIudXBkYXRlZ2FtZUZpZWxkUGl4ZWxzQXNDYW52YXMoY3VycmVudENvbndheUdhbWUpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIm5leHQgZ2VuZXJhdGlvblwiICsgZ2VuZXJhdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHNsZWVwKDIwMCldO1xuICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDQ7XG4gICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICBnZW5lcmF0aW9uKys7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDJdO1xuICAgICAgICAgICAgICAgIGNhc2UgNTogcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbi8vIGV4cGVjdHMgaHRtbCB0byBiZSBsb2FkZWRcbm1haW4oKTtcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGlzIHJlZmVyZW5jZWQgYnkgb3RoZXIgbW9kdWxlcyBzbyBpdCBjYW4ndCBiZSBpbmxpbmVkXG52YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18oMTU2KTtcbiJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsIkNvbndheUhUTUxEaXNwbGF5ZXIiLCJERUZBVUxUR0FNRVJVTEUiLCJDb253YXlHYW1lRmFjdG9yeSIsIkNvbndheUdhbWUiLCJDb253YXlDZWxsIiwiYWxpdmUiLCJ0aGlzIiwicHJvdG90eXBlIiwiZ2V0IiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIkNlbGxQb3NpdGlvbiIsInhQb3MiLCJ5UG9zIiwiQ29ud2F5R2FtZVJ1bGUiLCJyZXN1bHRfc3RhdGUiLCJ2aWV3ZWRfY2VsbHMiLCJhbGl2ZV9nb2VzX3RvX3Jlc3VsdF9zdGF0ZV93aXRoX25laWdoYm91cnMiLCJkZWFkX2dvZXNfdG9fcmVzdWx0X3N0YXRlX3dpdGhfbmVpZ2hib3VycyIsInZpZXdlZF9jZWxsX3Bvc2l0aW9ucyIsImFwcGx5UnVsZVRvR2FtZSIsIm9sZF9jb253YXlfZ2FtZSIsIm5ld19jb253YXlfZ2FtZSIsImxpdmluZ19uZWlnaGJvdXJfY291bnQiLCJjZWxsX2xpdmluZ19uZWlnaGJvdXJzIiwiZ2FtZUZpZWxkIiwiY2VsbCIsImlzX2FsaXZlX25laWdoYm91cl9jb3VudCIsInNvbWUiLCJpc19kZWFkX25laWdoYm91cl9jb3VudCIsImlzX2FsaXZlIiwicHhTaXplIiwicHlTaXplIiwiY2VsbHMiLCJydWxlcyIsImJvcmRlclJ1bGVzIiwieFNpemUiLCJ5U2l6ZSIsImNyZWF0ZV9lbXB0eV9jb253YXlzX2NlbGxfYXJyYXkiLCJzZXRDZWxsIiwiX3RoaXMiLCJBcnJheSIsImZpbGwiLCJtYXAiLCJuZXh0X2NvbndheV9zdGF0ZSIsIm5ld19jb253YXlfY2VsbF9maWVsZCIsIl9sb29wXzEiLCJpbmRleFgiLCJfbG9vcF8yIiwiaW5kZXhZIiwidGhpc18xIiwiZm9yRWFjaCIsInJ1bGUiLCJsb29raW5nQXQiLCJjb3VudCIsImxpc3QiLCJ2YWwiLCJhcnIiLCJ4MSIsInhQb3NpdGlvbiIsInkxIiwieVBvc2l0aW9uIiwiYSIsImIiLCJpbl9maWVsZCIsImNlbnRlcmVkZlBlbnRvbWlubyIsImNvbnNvbGUiLCJlcnJvciIsInBvcyIsImdldF9jZW50ZXIiLCJjb253YXlfZ2FtZSIsImNpcmNsZSIsInJhZGl1cyIsInJhZGl1c0luYyIsInBvc1RvUm90YXRlIiwiYW5nbGUiLCJNYXRoIiwiUEkiLCJuZXdYUG9zIiwicm91bmQiLCJjb3MiLCJzaW4iLCJuZXdZUG9zIiwibG9nIiwieWxpbmUiLCJsZW5ndGgiLCJjZW50ZXIiLCJjdXJMZW5ndGgiLCJtaWRkbGVYIiwiY2VpbCIsIm1pZGRsZVkiLCJyYW5kb21pemVfY2VsbHMiLCJyYW5kb20iLCJDZWxsQ29sb3IiLCJyIiwiZyIsIkNvbndheUdhbWVSZXByZXNlbnRlciIsImRlZmF1bHRfY2VsbF9hbGl2ZV9yZXByIiwiZGVmYXVsdF9jZWxsX2RlYWRfcmVwciIsImNlbGxfcmVwcl9hbGl2ZSIsImNlbGxfcmVwcl9kZWFkIiwiY2VsbF9yZXByX3RyYW5zcGFyZW50IiwicmVwcmVzZW50YXRpb24iLCJzdHJfZmllbGQiLCJyZXN1bHRfc3RyIiwiYXNfbnVtYmVyX2NvbG9yc19hcnIiLCJyZXN1bHQiLCJ4U3R5bGUiLCJ5U3R5bGUiLCJ4U3R5bGVDYW52YXMiLCJ5U3R5bGVDYW52YXMiLCJ1cGRhdGVFbW9qaUdhbWVGaWVsZEFzU3RyaW5nIiwiY29ud2F5R2FtZSIsImdhbWVTcGFjZSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJyZXByZXNlbnRlciIsImlubmVySFRNTCIsInVwZGF0ZWdhbWVGaWVsZFBpeGVsc0FzQ2FudmFzIiwic3R5bGUiLCJ3aWR0aCIsImhlaWdodCIsIm5ld19jYW52YXMiLCJjcmVhdGVFbGVtZW50IiwiY29udGV4dCIsImdldENvbnRleHQiLCJ4T2Zmc2V0IiwieU9mZnNldCIsImltYWdlRGF0YSIsImNyZWF0ZUltYWdlRGF0YSIsIm51bWJlcl9jb2xvcl9hcnIiLCJjdXJfcmVzX2luZGV4IiwiaSIsImRhdGEiLCJjZWxsX3JlcHJfZGF0YSIsInB1dEltYWdlRGF0YSIsImltYWdlU21vb3RoaW5nRW5hYmxlZCIsInJlcGxhY2VDaGlsZHJlbiIsImRpc3BsYXlHZW5lcmF0aW9uIiwiZ2VuZXJhdGlvbiIsImN1cnJlbnRHZW5lcmF0aW9uRWxlbWVudCIsIm5ld19lbGVtZW50IiwidG9TdHJpbmciLCJjaGlsZE5vZGVzIiwiZWxlbWVudCIsInJlbW92ZSIsImFwcGVuZENoaWxkIiwiU1VSUk9VTkRJTkdQT1NJVElPTlMiLCJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIl9fZ2VuZXJhdG9yIiwiYm9keSIsImYiLCJ5IiwidCIsIl8iLCJsYWJlbCIsInNlbnQiLCJ0cnlzIiwib3BzIiwidmVyYiIsIlN5bWJvbCIsIml0ZXJhdG9yIiwibiIsInYiLCJvcCIsIlR5cGVFcnJvciIsImNhbGwiLCJwb3AiLCJwdXNoIiwiZ2FtZV9vZl9saWZlXzEiLCJzbGVlcCIsIm1zIiwic2V0VGltZW91dCIsImNvbndheUdhbWVGYWN0b3J5IiwiY3VycmVudENvbndheUdhbWUiLCJmaWVsZF9kcmF3ZXIiLCJfYSIsIm1haW4iLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIl0sInNvdXJjZVJvb3QiOiIifQ==